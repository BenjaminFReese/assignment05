---
title: "Assignment 05"
author: "Benjamin Reese"
format: html
---

```{r, warning=FALSE, message=FALSE}
## Packages
library(tidyverse)
library(stringr)
library(readr)
library(lubridate)
library(sf)
library(tigris)
library(patchwork)
```

## 1. Data Cleaning and Loading

```{r, warning=FALSE, message=FALSE}
## Data Loading
crimes <- read_csv("data/crimes-reduced.csv", col_types = cols(Latitude = col_character(), 
        Longitude = col_character()))

## Data Cleaning
crimes <- crimes %>%
  rename_all(funs(str_to_lower(.) %>% ## changing to lowercase
                    str_replace_all(., '\\s','_') ## removing spaces
                  )
  )
```

## 2. Filtering Data

```{r, warning=FALSE, message=FALSE}
## Formatting date variable, filtering out NAs, and only including homicides
crimes_lim <- crimes %>%
  mutate(date = as_date(mdy_hms(date, tz= "America/Chicago"))) %>%
  filter(primary_type == "HOMICIDE", 
         !is.na(longitude), 
         !is.na(latitude), 
         !is.na(date),
         date  >= today() - years(10)
)

## Testing
table(year(crimes_lim$date))

min(crimes_lim$date)
```

## 3. Convert Lon/Lat to Points Geometry

```{r}
## Converting lat and lon and coloring dots by arrest
crimes_lim %>%
  st_as_sf(coords = c("longitude", "latitude")) %>%
  st_set_crs(value = 4326) %>%
  ggplot() +
  geom_sf(aes(color=arrest), alpha=.2) ## using alpha for transparency

```


